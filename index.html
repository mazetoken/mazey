<!DOCTYPE html>
<html lang="en">
<head>
  	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
  	<title>Mazey wallet</title>
	<meta name="description" content="Mazey, Bitcoin Cash, CashTokens, mini wallet">
  	<meta name="web" content="https://mazetoken.github.io/mazey/">
	<style>
		body {
			text-align: center;
			overflow-wrap: anywhere;
			max-width: 800px;
			margin: auto;
			font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
			background-color: black;
			font-size: large;
			color: whitesmoke;
		}
		p {
			font-size: 14px;
		}
		a:link {
			color: #0AC18E;
			background-color: transparent;
			text-decoration: none;
		}
		a:visited {
			color: #0AC18E;
			background-color: transparent;
			text-decoration: none;
		}
		.collapsible {
			background-color: #0AC18E;
			border-radius: 12px;
			font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
			color: white;
			cursor: pointer;
			padding: 18px;
			width: 50%;
			border: none;
			text-align: center;
			outline: none;
			font-size: 14px;
		}
		.active, .collapsible:hover {
			background-color: #0AC18E;
		}
		.content {
			padding: 0 16px;
			display: none;
			overflow: hidden;
			background-color: black;
		}
		@media screen and (max-width: 512px) {}
	</style>
	<script defer src="https://cdn.jsdelivr.net/npm/mainnet-js@1.1.30/dist/mainnet-1.1.30.js" integrity="sha256-S/RegobQoEoBav/3F8EuKdoQK1hytruPVQNfqpZBZMA=" crossorigin="anonymous"></script>
</head>
<body>
	<div>
		<h1>MAZEy</h1>
		<h3>Bitcoin Cash CashTokens mini wallet</h3>
		<p>It can be used locally, on a pendrive, SD card, floppy disk, etc.</p>
		<p>Clear local storage if the wallet is being used on someone else's device.</p>
		<p>Use it at your own risk and with small amount of BCH.</p>
		<p>The wallet is under development. Viewing and sending NFT CashTokens is not fully implemented.</p>
		</p>
		<br>
		<hr>
		<div>
			<button type="button" class="collapsible">Create wallet</button>
			<div class="content">
				<p><button id="create">Create</button></p>
				<p id="bchaddress1"></p>
				<p id="cashtokensaddress1"></p>
				<p id="bchbalance1"></p>
				<p id="mnemonic1"></p>
				<p id="derivation1"></p>
				<p id="privatekey1"></p>
				<p id="tokens1"></p>
				<p id="nfts1"></p>
				<p>Save seed phrase and private key!</p>
			</div>
		</div>
		<hr>
		<div>
			<button type="button" class="collapsible">Open wallet</button>
			<div class="content">
				<p><button type="button" id="open">Open</button></p>
				<p id="bchaddress2"></p>
				<p id="cashtokensaddress2"></p>
				<p id="bchbalance2"></p>
				<p id="mnemonic2"></p>
				<p id="derivation2"></p>
				<p id="privatekey2"></p>
				<p id="tokens2"></p>
				<p id="nfts2"></p>
				<p>To update your balances, refresh the page and click "Open".</p>
			</div>
		</div>
		<hr>
		<div>
			<button type="button" class="collapsible">Login with seed phrase or private key</button>
			<div class="content">
				<p><input id="importSeedPhrase" type="text" size="56" placeholder="seed phrase"></p>
				<p>or</p>
				<p><input id="importPrivateKey" type="text" size="56" placeholder="private key (WIF)"></p>
				<p><button type="button" id="login">Import</button></p>
				<p id="loginConf1"></p>
				<p id="loginConf2"></p>
				<p>The seed phrase or private key will be stored in the local storage of the browser.</p>
			</div>
		</div>
		<hr>
		<div>
			<button type="button" class="collapsible">Clear local storage</button>
			<div class="content">
				<p><button type="button" id="clear">Clear</button></p>
				<p id="clear1"></p>
				<p>The seed phrase or private key will be removed from the local storage of the browser.</p>
			</div>
		</div>
		<hr>
		<div>
			<button type="button" class="collapsible">View token details</button>
			<div class="content">
				<p>Choose metadata registry from the list.<br>
					If custom BCMR is selected, paste url in the input field.
				</p>
				<select id="bcmrList">
					<option value="https://mazetoken.github.io/.well-known/bitcoin-cash-metadata-registry.json">Maze Token MTU BCMR</option>
					<option value="https://mazetoken.github.io/darklabs/bcmr/darklabsbcmr.json">Dark Labs CRC20 BCMR</option>
					<option value="https://mazetoken.github.io/.well-known/crc20tobcmr.json">CRC20-to-BCMR</option>
					<option value="https://otr.cash/.well-known/bitcoin-cash-metadata-registry.json">Open Token Registry</option>
					<option value="">custom BCMR</option>
				</select>
				<p><input id="bcmrCustom" type="text" size="56" placeholder="custom BCMR"></p>
				<p><input id="viewTokenId" type="text" size="56" placeholder="tokenId"></p>
				<p><button type="button" id="viewTokens">View</button></p>
				<p id="tokencategory3"></p>
				<p id="tokenname3"></p>
				<p id="tokensymbol3"></p>
				<p id="tokendecimals3"></p>
				<p id="tokendescription3"></p>
				<img src id="tokenicon3" width="200"></p>
			
				<p>on-chain BCMR (AuthChain)</p>
				<p><input id="viewTokenId1" type="text" size="56" placeholder="tokenId"></p>
				<p><button type="button" id="viewTokens1">View</button></p>
				<p><i>Wait a few seconds</i></p>
				<p id="tokencategory4"></p>
				<p id="tokenname4"></p>
				<p id="tokensymbol4"></p>
				<p id="tokendecimals4"></p>
				<p id="tokendescription4"></p>
				<img src id="tokenicon4" width="200"></p>

				<p>Paytaca api</p>
				<p><input id="viewTokenId2" type="text" size="56" placeholder="tokenId"></p>
				<p><button type="button" id="viewTokens2">View</button></p>
				<p id="tokenapi"></p>
			</div>
		</div>
		<hr>
		<div>
			<button type="button" class="collapsible">Send BCH</button>
			<div class="content">
				<p><input id="sendAddr" type="text" size="56" placeholder="bitcoincash:q... or bitcoincash:z..."></p>
				<p><input id="sendAmount" type="text" size="56" placeholder="amount in satoshis"></p>
				<p><button id="sendBCH">Send BCH</button></p>
				<p id="bchsent"></p>
			</div>
		</div>
		<hr>
		<div>
			<button type="button" class="collapsible">Send fungible CashTokens</button>
			<div class="content">
				<p><input id="sendAddrToken" type="text" size="56" placeholder="bitcoincash:z..."></p>
				<p><input id="sendAmountToken" type="text" size="56" placeholder="amount with decimal places"></p>
				<p><input id="sendTokenId" type="text" size="56" placeholder="tokenId"></p>
				<p><button id="sendTokens">Send tokens</button></p>
				<p id="ftsent"></p>
			</div>
		</div>
		<hr>
		<div>
			<button type="button" class="collapsible">Send NFT CashTokens</button>
			<div class="content">
				<p><input id="sendAddrToken1" type="text" size="56" placeholder="bitcoincash:z..."></p>
				<p><input id="sendNftTokenId" type="text" size="56" placeholder="tokenId"></p>
				<p><input id="nftCommitment" type="text" size="56" placeholder="NFT commitment"></p>
				<p><button id="sendNfts">Send NFTs</button></p>
				<p id="nftsent"></p>
			</div>
		</div>
		<hr>
		<div>
			<button type="button" class="collapsible">Payment request url (BCH only)</button>
			<div class="content">
				<p><input id="address" type="text" size="56" placeholder="address e.g. bitcoincash:qzud8n6jjjukefrswrqlvwwk8l6wv7435yg56xw20s"></p>
				<p><input id="amount" type="text" size="56" placeholder="amount e.g. 0.0001"></p>
				<p><input id="label" type="text" size="56" placeholder="some text"></p>
				<p><button id="createPaymentRequest">Create payment url</button></p>
				<p id="payurl"></p>
				
				<p><input id="upayurl" type="text" size="56" placeholder="payment request url"></p>
				<p><button id="usePaymentRequest">Use payment url</button></p>
				<p id="usepayurl"></p>
			</div>
		</div>
		<hr>
		<div>
			<button type="button" class="collapsible">Sign or verify a message</button>
			<div class="content">
				<p><input id="smessage" type="text" size="56" placeholder="message"></p>
				<p><button id="signM">Sign a message</button></p>
				<p id="signMessage"></p>
				
				<p><input id="vaddress" type="text" size="56" placeholder="signing address"></p>
				<p><input id="signH" type="text" size="56" placeholder="signature"></p>
				<p><button id="verifyM">Verify a message</button></p>
				<p id="verifyMessage"></p>
			</div>
		</div>
		<hr>
		<br>
		<footer>
			<p><a href="https://github.com/mazetoken/mazey/">Github</a> | <a href="https://t.me/mazetokens/">Telegram</a></p>
			<p>Check <a href="https://microfi.eu">Microfi Free Flow CashToken</a></p>
			<p>Powered by <a href="https://mainnet.cash">mainnet-js</a></p>
			<p>Mazey, 2023</p>
		</footer>
		<br>
	</div>

	<script>
		var coll = document.getElementsByClassName("collapsible");
		var i;
		for (i = 0; i < coll.length; i++) {
		  coll[i].addEventListener("click", function() {
			this.classList.toggle("active");
			var content = this.nextElementSibling;
			if (content.style.display === "block") {
			  content.style.display = "none";
			} else {
			  content.style.display = "block";
			}
		  });
		}
	</script>

	<script>
	document.addEventListener("DOMContentLoaded", async (event) => {
		globalThis.exports = globalThis.exports || {};
		Object.assign(globalThis, await __mainnetPromise);
		Config.DefaultParentDerivationPath = "m/44'/145'/0'/0/0";
		//Config.EnforceCashTokenReceiptAddresses = true;

		document.getElementById("create").onclick = async () => {
			const wallet = await Wallet.named("mazey");
			localStorage.setItem("seed", wallet.mnemonic);
			localStorage.setItem("wif", wallet.privateKeyWif);
			const tokenAddress = await wallet.getTokenDepositAddress();
			let tokensAddressBalance = await wallet.getAllTokenBalances();
			let nftsAddressBalance = await wallet.getAllNftTokenBalances();
			const bchAddress = await wallet.getDepositAddress();
			let bchBalance = await wallet.getBalance();
			
			document.getElementById("bchaddress1").textContent = "BCH address: " + bchAddress;
			document.getElementById("cashtokensaddress1").textContent = "CashTokens address: " + tokenAddress;
			document.getElementById("bchbalance1").textContent = "BCH balance: " + JSON.stringify(bchBalance);
			document.getElementById("mnemonic1").textContent = "Seed phrase: " + wallet.mnemonic;
			document.getElementById("derivation1").textContent = "Derivation path: " + wallet.derivationPath;
			document.getElementById("privatekey1").textContent ="Private key: " + wallet.privateKeyWif;
			document.getElementById("tokens1").textContent = "Tokens: " + JSON.stringify(tokensAddressBalance, null, "\t");
			document.getElementById("nfts1").textContent = "NFTs: " + JSON.stringify(nftsAddressBalance, null, "\t");
		};

		document.getElementById("open").onclick = async () => {
			var wallet = await Wallet.named("mazey");
			const sd = localStorage.getItem("seed");
			const derivationPath = "m/44'/145'/0'/0/0";
			const walletId1 = `seed:mainnet:${sd}:${derivationPath}`;
			const pk = localStorage.getItem("wif");
			if (wallet = sd) {
				var wallet = await Wallet.replaceNamed("mazey", walletId1);
			} else if (wallet = pk) {
				var wallet = await Wallet.fromWIF(pk);
			}
			const tokenAddress = await wallet.getTokenDepositAddress();
			let tokensAddressBalance = await wallet.getAllTokenBalances();
			let nftsAddressBalance = await wallet.getAllNftTokenBalances();
			const bchAddress = await wallet.getDepositAddress();
			let bchBalance = await wallet.getBalance();
			
			document.getElementById("bchaddress2").textContent = "BCH address: " + bchAddress;
			document.getElementById("cashtokensaddress2").textContent = "CashTokens address: " + tokenAddress;
			document.getElementById("bchbalance2").textContent = "BCH balance: " + JSON.stringify(bchBalance);
			document.getElementById("mnemonic2").textContent = "Seed phrase: " + wallet.mnemonic;
			document.getElementById("derivation2").textContent = "Derivation path: " + wallet.derivationPath;
			document.getElementById("privatekey2").textContent ="Private key: " + wallet.privateKeyWif;
			document.getElementById("tokens2").textContent = "Tokens: " + JSON.stringify(tokensAddressBalance, null, "\t");
			document.getElementById("nfts2").textContent = "NFTs: " + JSON.stringify(nftsAddressBalance, null, "\t");
		};

		document.getElementById("login").onclick = async () => {
			const seed = document.querySelector("#importSeedPhrase").value;
			localStorage.setItem("seed", seed);
			const privatekey = document.querySelector("#importPrivateKey").value;
			localStorage.setItem("wif", privatekey);
			document.getElementById("loginConf1").textContent = "You are logged in with seed phrase: " + seed;
			document.getElementById("loginConf2").textContent = "You are logged in with privatekey: " + privatekey;
		}

		document.getElementById("clear").onclick = async () => {
			localStorage.clear();
			document.getElementById("clear1").textContent = "Local storage is cleared. You have to login again.";
		}

		document.getElementById("viewTokens").onclick = async () => {
			const bcmrList = document.querySelector("#bcmrList").value;
			const bcmrCustom = document.querySelector("#bcmrCustom").value;
			if (bcmrUrl = bcmrList) {
			await BCMR.addMetadataRegistryFromUri(bcmrList);
			} else if (bcmrUrl = bcmrCustom) {
			await BCMR.addMetadataRegistryFromUri(bcmrCustom);
			}
			const viewTokenId = document.querySelector("#viewTokenId").value;
			const tokenInfo = BCMR.getTokenInfo(viewTokenId);
			document.getElementById("tokencategory3").textContent = "Category/tokenId: " + tokenInfo.token.category;
			document.getElementById("tokenname3").textContent = "Name: " + tokenInfo.name;
			document.getElementById("tokensymbol3").textContent = "Symbol: " + tokenInfo.token.symbol;
			document.getElementById("tokendecimals3").textContent = "Decimals: " + tokenInfo.token.decimals;
			document.getElementById("tokendescription3").textContent = "Description: " + tokenInfo.description;
			document.getElementById("tokenicon3").src = tokenInfo.uris.icon;
		};

		document.getElementById("viewTokens1").onclick = async () => {
			const viewTokenId1 = document.querySelector("#viewTokenId1").value;
			const authChain = await BCMR.buildAuthChain({
				transactionHash: viewTokenId1,
				followToHead: true
			});
			if (authChain[0]) {
			try {
				await BCMR.addMetadataRegistryFromUri(authChain[0].httpsUrl);
			} catch (error) { alert(error) }
			}
			const tokenInfo = BCMR.getTokenInfo(viewTokenId1);
			document.getElementById("tokencategory4").textContent = "Category/tokenId: " + tokenInfo.token.category;
			document.getElementById("tokenname4").textContent = "Name: " + tokenInfo.name;
			document.getElementById("tokensymbol4").textContent = "Symbol: " + tokenInfo.token.symbol;
			document.getElementById("tokendecimals4").textContent = "Decimals: " + tokenInfo.token.decimals;
			document.getElementById("tokendescription4").textContent = "Description: " + tokenInfo.description;
			document.getElementById("tokenicon4").src = tokenInfo.uris.icon;
		};

		document.getElementById("viewTokens2").onclick = async () => {
			const viewTokenId2 = document.querySelector("#viewTokenId2").value;
			const apiUrl = "https://bcmr.paytaca.com/api/tokens/" + viewTokenId2;
			fetch(apiUrl)
				.then(response => response.json())
				.then(data => document.getElementById("tokenapi").textContent = 
				data.name + " " + data.token.symbol + " " + "| Decimals: " + data.token.decimals + " " + "| Description: " + data.description + " " + " " + "| Web: " + data.uris.web + " " + "| Icon: " + data.uris.icon
				);
		};

		document.getElementById("sendBCH").onclick = async () => {
			try {
			const bchAddress = document.querySelector("#sendAddr").value;
			const bchAmount = document.querySelector("#sendAmount").value;
			const wallet = await Wallet.named("mazey");
			const { txId } = await wallet.send([
				{
				cashaddr: bchAddress,
				value: bchAmount,
				unit: "sat"
				}
			]);
			document.getElementById("bchsent").textContent = "TxId: " + txId;
			} catch (error) { alert(error) }
		};

		document.getElementById("sendTokens").onclick = async () => {
			try {
			const tokenAddress = document.querySelector("#sendAddrToken").value;
			const tokenAmount = document.querySelector("#sendAmountToken").value;
			const token = document.querySelector("#sendTokenId").value;
			const wallet = await Wallet.named("mazey");
			const { txId } = await wallet.send([new TokenSendRequest(
				{
				cashaddr: tokenAddress,
				amount: tokenAmount,
				tokenId: token
				}
			)]);
			document.getElementById("ftsent").textContent = "TxId: " + txId;
			} catch (error) { alert(error) }
		};

		document.getElementById("sendNfts").onclick = async () => {
			try {
			const tokenAddress = document.querySelector("#sendAddrToken1").value;
			const token1 = document.querySelector("#sendNftTokenId").value;
			const nftCommitment = document.querySelector("#nftCommitment").value;
			const wallet = await Wallet.named("mazey");
			const { txId } = await wallet.send([new TokenSendRequest(
				{
				cashaddr: tokenAddress,
				tokenId: token1,
				commitment: nftCommitment,
				capability: NFTCapability.none
				}
			)]);
			document.getElementById("nftsent").textContent = "TxId: " + txId;
			} catch (error) { alert(error) }
		};
	});
	</script>

	<script>
		document.getElementById("createPaymentRequest").onclick = async () => {
		const pAddress = document.querySelector("#address").value;
		const pAmount = document.querySelector("#amount").value;
		const pLabel = document.querySelector("#label").value;
		const pUrl = pAddress + "?amount=" + pAmount + "&label=" + pLabel;">";
		document.getElementById("payurl").textContent = pUrl;
		//location.href = pUrl;
		};
		document.getElementById("usePaymentRequest").onclick = async () => {
		const uPayUrl = document.querySelector("#upayurl").value;
		//const upUrl = uPayUrl;
		document.getElementById("usepayurl").textContent = uPayUrl;
		location.href = uPayUrl;
		};
	</script>

	<script>
		document.getElementById("signM").onclick = async () => {
		const sMessage = document.querySelector("#smessage").value;
		const wallet = await Wallet.named("mazey");
		wallet.cashaddr;
		sign = (await wallet.sign(sMessage)).signature;
		document.getElementById("signMessage").textContent = sign;
		};
		document.getElementById("verifyM").onclick = async () => {
		const vAddress = document.querySelector("#vaddress").value;
		const signatureHash = document.querySelector("#signH").value;
		someWallet = await Wallet.watchOnly(vAddress);
		verifyResult = await someWallet.verify(vAddress, signatureHash);
		document.getElementById("verifyMessage").textContent = verifyResult.valid;
		};
	</script>
</body>
</html>